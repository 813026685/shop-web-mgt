(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6092"],{BbZQ:function(e,t,a){"use strict";a.r(t);var o=a("P2sY"),i=a.n(o),l=a("QbLZ"),n=a.n(l),s=a("QSRe"),r=a("ZySA"),c=(a("7Qib"),a("Mz3J")),u=a("ZfUE"),p=a("BEYb"),m=a("oBYj"),f=a("a0Nf"),d=a("Q4Eu"),h=a("41Be"),v=a("L2JU"),b={name:"couponTemplateManager",components:{Pagination:c.a,SysCode:u.a,FormDialog:p.a,UserCouponList:m.a},directives:{waves:r.a,permission:d.a},filters:{},data:function(){return{cacheData:{},tableKey:0,list:null,total:0,listLoading:!0,listQuery:{pageNum:0,pageSize:10,orderBy:"+id",merchantNo:""},currentTemplate:{},multipleSelection:[],formVisible:!1,formVisibleCoupon:!1,grantVisible:!1,isEdit:!1,formData:{id:null,merchantNo:"",remark:"",couponType:"",cpName:"",publishMethod:"102201",publishNum:0,status:"100000",validDays:0,cpCondition:"",conditionValue:-1,description:"",reason:"",unitDesc:"元",cpValue:"",valueDesc:""},rules:{cpName:[{required:!0,message:"券名称必填",trigger:"blur"}],cpValue:[{required:!0,message:"折扣金额必填",trigger:"blur"}],valueDesc:[{required:!0,message:"折扣文案必填",trigger:"blur"}],unitDesc:[{required:!0,message:"单位文案必填",trigger:"blur"}],status:[{required:!0,message:"状态必选",trigger:"blur"}],cpCondition:[{required:!0,message:"满减条件必填",trigger:"blur"}],conditionValue:[{required:!0,message:"满减金额必填",trigger:"blur"}],couponType:[{required:!0,message:"类型必选择",trigger:"blur"}],validDays:[{required:!0,message:"有效天数必填",trigger:"blur"}]}}},computed:n()({},Object(v.b)(["merchantNo"])),created:function(){},mounted:function(){var e=this;Object(f.a)(this.cacheData,"1000,1021,1024,1022").then(function(){e.handleQueryList()})},methods:{checkPermission:h.a,cellStyle:function(){return"padding: 5px 0px;"},handleFilter:function(){this.listQuery.pageNum=0,this.handleQueryList()},handleReset:function(){this.listQuery.pageNum=0,this.handleQueryList()},handleQueryList:function(){var e=this;this.listLoading=!0;var t={pageSize:this.listQuery.pageSize,pageNum:this.listQuery.pageNum};Object(s.c)(t).then(function(t){e.list=t.list,e.total=t.total}).catch(function(e){console.log(e)}).finally(function(){e.listLoading=!1})},formOpen:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isEdit=t,this.formVisible=!0,this.formData=t?i()({},e):{}},formOpenOffer:function(e){this.currentTemplate=e,this.formVisibleCoupon=!0},formClose:function(){this.formVisible=!1,this.$refs.formData.resetFields()},formCloseCoupon:function(){this.formVisibleCoupon=!1},handlePublish:function(e){this.$confirm("确认生成优惠券？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.b)(e).then(function(e){})})},handleOffer:function(e,t){var a=this,o=e.map(function(e){return e.uid});Object(s.f)({templateId:this.currentTemplate.id,userIds:o}).then(function(e){a.formVisibleCoupon=!1})},handleFormSave:function(){var e=this;this.$refs.formData.validate(function(t){t&&(e.formData.merchantNo=e.merchantNo,Object(s.d)(e.formData).then(function(t){e.handleFilter(),e.formVisible=!1}).catch(function(e){console.log(e)}))})},handleSelectionChange:function(e){this.multipleSelection=e},handleSelected:function(e){var t=this.multipleSelection;!t.length||0==t.length||t.length>1?this.$message({type:"warning",message:"请选择一条数据进行操作"}):"edit"===e&&this.formOpen(t[0],!0)},handleMultiSelected:function(e){var t=this.multipleSelection;t.length&&0!=t.length||this.$message({type:"warning",message:"请至少选择一条数据进行操作"})}}},g=(a("woX+"),a("KHd+")),_=Object(g.a)(b,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"actions-container"},[a("el-row",[a("el-col",{attrs:{span:18}},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"action-item",attrs:{size:"small",icon:"el-icon-plus"},on:{click:e.formOpen}},[e._v(e._s(e.$t("table.add")))]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"action-item",attrs:{size:"small",icon:"el-icon-edit"},on:{click:function(t){e.handleSelected("edit")}}},[e._v(e._s(e.$t("table.edit")))])],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"right-actions"},[a("el-button",{staticClass:"action-item",attrs:{size:"small",icon:"el-icon-circle-close-outline"},on:{click:e.handleReset}},[e._v(e._s(e.$t("table.reset")))]),e._v(" "),a("el-button",{staticClass:"action-item",attrs:{size:"small",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v(e._s(e.$t("table.query")))])],1)])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,border:"",fit:"","highlight-current-row":"","default-sort":{prop:"createdDate",order:"descending"}},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"模版名称",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.cpName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"折扣金额（分）",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.cpValue))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"金额文案",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.valueDesc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"单位文案",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.unitDesc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"满减金额（分）",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.conditionValue))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"满减条件","show-overflow-tooltip":!0,align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.cpCondition))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"使用注意描述","show-overflow-tooltip":!0,align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.description))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"优惠券类型",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("statusFilter")(t.row.couponType,e.cacheData.statusMap[1021])))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"发放方式",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("statusFilter")(t.row.publishMethod,e.cacheData.statusMap[1022])))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"生成数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.publishNum))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"备注",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.remark))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createdTime",sortable:"",label:e.$t("table.createdTime"),width:"200px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("parseTime")(t.row.createdTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("table.actions"),align:"center",width:"150",fixed:"right","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("table.edit"),placement:"top-start"}},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"action-item",attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){e.formOpen(t.row,!0)}}})],1),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"action-item",attrs:{type:"text"},on:{click:function(a){e.handlePublish(t.row.id)}}},[e._v("生成")]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"action-item",attrs:{type:"text"},on:{click:function(a){e.formOpenOffer(t.row)}}},[e._v("发放")])]}}])})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.listQuery.pageNum,limit:e.listQuery.pageSize},on:{"update:page":function(t){e.$set(e.listQuery,"pageNum",t)},"update:limit":function(t){e.$set(e.listQuery,"pageSize",t)},pagination:e.handleQueryList}}),e._v(" "),a("form-dialog",{attrs:{visible:e.formVisible,title:e.isEdit?e.$t("table.edit"):e.$t("table.add")},on:{"update:visible":function(t){e.formVisible=t},onCancel:e.formClose,onSubmit:e.handleFormSave}},[a("el-form",{ref:"formData",attrs:{rules:e.rules,model:e.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"券名称",width:"120px",prop:"cpName"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.formData.cpName,callback:function(t){e.$set(e.formData,"cpName",t)},expression:"formData.cpName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"金额数值（分）",width:"80px",prop:"cpValue"}},[a("el-input",{attrs:{placeholder:"单位分",autocomplete:"off"},model:{value:e.formData.cpValue,callback:function(t){e.$set(e.formData,"cpValue",t)},expression:"formData.cpValue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"金额文案",width:"100px",prop:"valueDesc"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.formData.valueDesc,callback:function(t){e.$set(e.formData,"valueDesc",t)},expression:"formData.valueDesc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"单位文案",width:"80px",prop:"unitDesc"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.formData.unitDesc,callback:function(t){e.$set(e.formData,"unitDesc",t)},expression:"formData.unitDesc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"满减金额（分）",prop:"conditionValue"}},[a("el-input",{attrs:{placeholder:"(-1)不限制金额",autocomplete:"off"},model:{value:e.formData.conditionValue,callback:function(t){e.$set(e.formData,"conditionValue",t)},expression:"formData.conditionValue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"满减条件",prop:"cpCondition"}},[a("el-input",{attrs:{type:"textarea",autocomplete:"off"},model:{value:e.formData.cpCondition,callback:function(t){e.$set(e.formData,"cpCondition",t)},expression:"formData.cpCondition"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"使用注意描述",width:"150px",prop:"description"}},[a("el-input",{attrs:{type:"textarea",autocomplete:"off"},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"发放方式",prop:"publishMethod"}},[e.cacheData.codes?a("sys-code",{attrs:{cacheOptions:e.cacheData.codes,typeCode:"1022",selected:e.formData.publishMethod},on:{"update:selected":function(t){e.$set(e.formData,"publishMethod",t)}}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启用",prop:"status"}},[e.cacheData.codes?a("sys-code",{attrs:{cacheOptions:e.cacheData.codes,typeCode:"1000",selected:e.formData.status},on:{"update:selected":function(t){e.$set(e.formData,"status",t)}}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券类型",prop:"couponType"}},[e.cacheData.codes?a("sys-code",{attrs:{cacheOptions:e.cacheData.codes,typeCode:"1021",selected:e.formData.couponType},on:{"update:selected":function(t){e.$set(e.formData,"couponType",t)}}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"发放数量",withd:"80px",prop:"publishNum"}},[a("el-input",{attrs:{placeholder:"-1表示不限制数量",autocomplete:"off"},model:{value:e.formData.publishNum,callback:function(t){e.$set(e.formData,"publishNum",t)},expression:"formData.publishNum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"领取后有效天数",withd:"80px",prop:"validDays"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.formData.validDays,callback:function(t){e.$set(e.formData,"validDays",t)},expression:"formData.validDays"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",autocomplete:"off"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1)],1),e._v(" "),a("user-coupon-list",{attrs:{visible:e.formVisibleCoupon,title:"发送优惠券"},on:{"update:visible":function(t){e.formVisibleCoupon=t},onCancel:e.formCloseCoupon,onSubmit:e.handleOffer}},[a("div")])],1)},[],!1,null,"cade7ef2",null);_.options.__file="couponTemplateManager.vue";t.default=_.exports},pV3i:function(e,t,a){},"woX+":function(e,t,a){"use strict";var o=a("pV3i");a.n(o).a}}]);